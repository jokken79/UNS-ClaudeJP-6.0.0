â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         MATRIZ DE INCONSISTENCIAS: VALIDACIÃ“N DE ROLES POR ARCHIVO            â•‘
â•‘                              UNS-ClaudeJP 5.4.1                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARCHIVO: backend/app/services/auth_service.py                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PROBLEMAS:                                                                      â”‚
â”‚   ğŸ”´ LÃ­neas 451-455: DEV TOKEN BYPASS                                          â”‚
â”‚      - Permite acceso sin verificaciÃ³n JWT en modo desarrollo                 â”‚
â”‚      - Token "dev-admin-token-*" retorna admin automÃ¡ticamente                â”‚
â”‚      - CRÃTICO: Riesgo de quedar en producciÃ³n                                â”‚
â”‚                                                                                â”‚
â”‚   ğŸŸ¡ LÃ­neas 552-569: require_role() usa strings en lugar de enums             â”‚
â”‚      - required_role = "admin" vs "ADMIN"                                     â”‚
â”‚      - Inconsistente con models.py (UserRole.ADMIN)                           â”‚
â”‚      - ConfusiÃ³n entre strings y enums                                         â”‚
â”‚                                                                                â”‚
â”‚ ESTADO: âš ï¸ REQUIERE CORRECCIÃ“N INMEDIATA                                      â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARCHIVO: backend/app/api/auth.py                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PROBLEMAS:                                                                      â”‚
â”‚   ğŸ”´ LÃ­neas 138-143: Token en response body + HttpOnly cookies                â”‚
â”‚      - Frontend recibe token en JSON body                                      â”‚
â”‚      - CÃ³digo la guarda en localStorage                                        â”‚
â”‚      - Vulnerabilidad XSS si localStorage se ve comprometido                   â”‚
â”‚                                                                                â”‚
â”‚   ğŸŸ  LÃ­nea 24: POST /api/auth/register ABIERTO                                â”‚
â”‚      - Sin validaciÃ³n de contraseÃ±a                                            â”‚
â”‚      - Sin email verification                                                  â”‚
â”‚      - Rate limit dÃ©bil (3/hora)                                              â”‚
â”‚                                                                                â”‚
â”‚   ğŸŸ  LÃ­nea 70: Rate limit dÃ©bil en login                                      â”‚
â”‚      - 5/minuto = 7200 intentos/dÃ­a por IP                                    â”‚
â”‚      - Vulnerable a fuerza bruta                                               â”‚
â”‚                                                                                â”‚
â”‚ ESTADO: âš ï¸ REQUIERE CORRECCIÃ“N INMEDIATA                                      â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARCHIVO: backend/app/api/deps.py                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PROBLEMAS:                                                                      â”‚
â”‚   ğŸŸ  LÃ­nea 36: require_admin() compara strings, no enums                       â”‚
â”‚      ```python                                                                  â”‚
â”‚      if current_user.role not in ["SUPER_ADMIN", "ADMIN"]:  # âŒ String       â”‚
â”‚      ```                                                                        â”‚
â”‚      DeberÃ­a ser:                                                               â”‚
â”‚      ```python                                                                  â”‚
â”‚      if current_user.role.name not in [UserRole.SUPER_ADMIN, ...]:  # âœ“      â”‚
â”‚      ```                                                                        â”‚
â”‚                                                                                â”‚
â”‚   ğŸŸ¡ No integra roles legacy (KEITOSAN, TANTOSHA)                             â”‚
â”‚      - require_admin() no los reconoce                                         â”‚
â”‚      - Inconsistencia con role_permissions.py                                 â”‚
â”‚                                                                                â”‚
â”‚ ESTADO: âš ï¸ REQUIERE REVISIÃ“N Y UNIFICACIÃ“N                                    â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARCHIVO: backend/app/api/apartments_v2.py                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PROBLEMAS:                                                                      â”‚
â”‚   ğŸ”´ Direct role comparisons (enums):                                          â”‚
â”‚      ```python                                                                  â”‚
â”‚      if current_user.role not in [UserRole.ADMIN, UserRole.COORDINATOR]:      â”‚
â”‚      ```                                                                        â”‚
â”‚      Issues:                                                                    â”‚
â”‚        - No usa require_role() centralizado                                    â”‚
â”‚        - Falta KANRININSHA (deberÃ­a tener acceso)                             â”‚
â”‚        - No incluye KEITOSAN, TANTOSHA                                         â”‚
â”‚        - Inconsistente con other endpoints                                     â”‚
â”‚                                                                                â”‚
â”‚ ESTADO: ğŸ”´ REQUIERE REFACTORIZACIÃ“N                                           â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARCHIVO: backend/app/api/employees.py                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PROBLEMAS:                                                                      â”‚
â”‚   ğŸ”´ Direct role comparison:                                                   â”‚
â”‚      ```python                                                                  â”‚
â”‚      if current_user.role != UserRole.SUPER_ADMIN:  # Solo SUPER_ADMIN        â”‚
â”‚      ```                                                                        â”‚
â”‚      Should be:                                                                 â”‚
â”‚      ```python                                                                  â”‚
â”‚      current_user: User = Depends(auth_service.require_role("super_admin"))   â”‚
â”‚      ```                                                                        â”‚
â”‚                                                                                â”‚
â”‚ ESTADO: ğŸ”´ REQUIERE REFACTORIZACIÃ“N                                           â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARCHIVO: backend/app/api/salary.py                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PROBLEMAS:                                                                      â”‚
â”‚   ğŸŸ¡ Inconsistencia en comparaciÃ³n:                                            â”‚
â”‚      ```python                                                                  â”‚
â”‚      if current_user.role.value == "EMPLOYEE":  # .value (string)             â”‚
â”‚      ```                                                                        â”‚
â”‚      vs en otros archivos:                                                     â”‚
â”‚      ```python                                                                  â”‚
â”‚      if current_user.role.name not in [...]:    # .name                       â”‚
â”‚      if current_user.role in [...]:             # enum directo                â”‚
â”‚      ```                                                                        â”‚
â”‚                                                                                â”‚
â”‚ ESTADO: ğŸŸ¡ REQUIERE CONSISTENCIA                                              â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARCHIVO: backend/app/api/timer_cards.py                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PROBLEMAS:                                                                      â”‚
â”‚   ğŸŸ¡ Inconsistencia en acceso a rol:                                           â”‚
â”‚      ```python                                                                  â”‚
â”‚      user_role = current_user.role.value  # Convierte a string                â”‚
â”‚      ```                                                                        â”‚
â”‚      Luego compara strings en lugar de enums                                   â”‚
â”‚                                                                                â”‚
â”‚ ESTADO: ğŸŸ¡ REQUIERE CONSISTENCIA                                              â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARCHIVO: backend/app/api/yukyu.py                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PROBLEMAS:                                                                      â”‚
â”‚   ğŸŸ  Manejo especial de roles legacy:                                          â”‚
â”‚      ```python                                                                  â”‚
â”‚      if current_user.role in [UserRole.ADMIN, UserRole.SUPER_ADMIN,          â”‚
â”‚                               UserRole.KEITOSAN]:  # Hardcoded                â”‚
â”‚      ```                                                                        â”‚
â”‚      Issues:                                                                    â”‚
â”‚        - KEITOSAN no estÃ¡ en jerarquÃ­a                                         â”‚
â”‚        - Debe manejarse en require_role()                                      â”‚
â”‚        - O en role_permissions.py                                              â”‚
â”‚                                                                                â”‚
â”‚ ESTADO: ğŸŸ  REQUIERE INTEGRACIÃ“N                                               â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARCHIVO: backend/app/api/role_permissions.py                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ STATUS: âœ“ OK - BASE DE DATOS CENTRALIZADA                                    â”‚
â”‚                                                                                â”‚
â”‚ FORTALEZAS:                                                                     â”‚
â”‚   âœ“ 54 pÃ¡ginas con control granular                                           â”‚
â”‚   âœ“ 8 roles (6 estÃ¡ndar + 2 legacy)                                           â”‚
â”‚   âœ“ Matriz de permisos configurable en runtime                                â”‚
â”‚   âœ“ Endpoints para gestionar permisos dinÃ¡micamente                           â”‚
â”‚                                                                                â”‚
â”‚ DEBILIDADES:                                                                    â”‚
â”‚   ğŸŸ¡ Puede desincronizarse con require_role() hardcodeado                     â”‚
â”‚   ğŸŸ¡ Permisos en auth_service.py vs permisos en DB                            â”‚
â”‚                                                                                â”‚
â”‚ RECOMENDACIÃ“N: Esta deberÃ­a ser la source of truth                            â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARCHIVO: backend/app/models/models.py                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PROBLEMAS:                                                                      â”‚
â”‚   ğŸŸ  Roles legacy definidos sin integraciÃ³n:                                  â”‚
â”‚      ```python                                                                  â”‚
â”‚      class UserRole(str, enum.Enum):                                          â”‚
â”‚          SUPER_ADMIN = "SUPER_ADMIN"       # âœ“ Integrado                     â”‚
â”‚          ADMIN = "ADMIN"                   # âœ“ Integrado                     â”‚
â”‚          COORDINATOR = "COORDINATOR"       # âœ“ Integrado                     â”‚
â”‚          KANRININSHA = "KANRININSHA"       # âœ“ Integrado                     â”‚
â”‚          EMPLOYEE = "EMPLOYEE"             # âœ“ Integrado                     â”‚
â”‚          CONTRACT_WORKER = "CONTRACT_WORKER" # âœ“ Integrado                   â”‚
â”‚          KEITOSAN = "KEITOSAN"             # âŒ NO integrado                 â”‚
â”‚          TANTOSHA = "TANTOSHA"             # âŒ NO integrado                 â”‚
â”‚      ```                                                                        â”‚
â”‚                                                                                â”‚
â”‚ ESTADO: ğŸŸ  REQUIERE DECISIÃ“N: DEPRECAR O INTEGRAR                            â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARCHIVO: frontend/stores/auth-store.ts                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PROBLEMAS:                                                                      â”‚
â”‚   ğŸ”´ Almacenamiento de token en localStorage:                                  â”‚
â”‚      ```typescript                                                              â”‚
â”‚      const createStorage = (): StateStorage => {                               â”‚
â”‚        if (typeof window === 'undefined') {                                    â”‚
â”‚          return {...};                                                          â”‚
â”‚        }                                                                        â”‚
â”‚        localStorage.removeItem('token');  // â† Token aquÃ­                     â”‚
â”‚        return localStorage;                                                    â”‚
â”‚      };                                                                        â”‚
â”‚      ```                                                                        â”‚
â”‚      Issues:                                                                    â”‚
â”‚        - localStorage es vulnerable a XSS                                      â”‚
â”‚        - Backend envÃ­a HttpOnly cookies                                        â”‚
â”‚        - DeberÃ­a usar solo cookies                                             â”‚
â”‚                                                                                â”‚
â”‚ ESTADO: ğŸ”´ REQUIERE REFACTORIZACIÃ“N                                           â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARCHIVO: frontend/lib/api.ts                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PROBLEMAS:                                                                      â”‚
â”‚   ğŸŸ¡ Dependencia de token en localStorage:                                     â”‚
â”‚      ```typescript                                                              â”‚
â”‚      const getAuthToken = (): string | null => {                              â”‚
â”‚        if (typeof window === 'undefined') {                                    â”‚
â”‚          return null;                                                          â”‚
â”‚        }                                                                        â”‚
â”‚        return useAuthStore.getState().token;  # â† De auth-store                â”‚
â”‚      };                                                                        â”‚
â”‚      ```                                                                        â”‚
â”‚                                                                                â”‚
â”‚   ğŸŸ¡ LÃ­neas 79-105: Axios interceptor agrega header manualmente               â”‚
â”‚      DeberÃ­a confiar en cookies HttpOnly                                       â”‚
â”‚                                                                                â”‚
â”‚ ESTADO: ğŸŸ¡ REQUIERE REFACTORIZACIÃ“N                                           â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    TABLA RESUMEN DE INCONSISTENCIAS                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PatrÃ³n 1: COMPARACIÃ“N DE STRINGS vs ENUMS                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚ âŒ INCONSISTENTE:                                                             â”‚
â”‚   auth_service.py:    required_role = "admin" (string)                       â”‚
â”‚   apartments_v2.py:   UserRole.ADMIN (enum)                                  â”‚
â”‚   deps.py:            "SUPER_ADMIN" (string)                                 â”‚
â”‚   timer_cards.py:     .value (string)                                        â”‚
â”‚   salary.py:          .value == "EMPLOYEE" (string)                          â”‚
â”‚                                                                               â”‚
â”‚ âœ“ DEBE SER:                                                                  â”‚
â”‚   Todos consistentemente con UserRole enum                                    â”‚
â”‚   O todos con strings normalizados                                            â”‚
â”‚   RECOMENDACIÃ“N: Usar UserRole enum everywhere                               â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PatrÃ³n 2: DIRECT CHECKS vs CENTRALIZADO                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚ âŒ DIRECTO (malo):                                                            â”‚
â”‚   if current_user.role not in [UserRole.ADMIN, ...]:                        â”‚
â”‚   if current_user.role != UserRole.SUPER_ADMIN:                             â”‚
â”‚   if current_user.role.value == "employee":                                  â”‚
â”‚                                                                               â”‚
â”‚ âœ“ CENTRALIZADO (bueno):                                                     â”‚
â”‚   current_user: User = Depends(auth_service.require_role("admin"))          â”‚
â”‚                                                                               â”‚
â”‚ PROBLEMA:                                                                     â”‚
â”‚   - 8 endpoints usan direct checks                                            â”‚
â”‚   - Inconsistencias en permisos incluidos                                     â”‚
â”‚   - KANRININSHA falta en muchos lugares                                       â”‚
â”‚   - Roles legacy (KEITOSAN, TANTOSHA) inconsistentes                         â”‚
â”‚                                                                               â”‚
â”‚ SOLUCIÃ“N:                                                                     â”‚
â”‚   Mover TODOS a require_role() centralizado en auth_service.py               â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PatrÃ³n 3: ROLES LEGACY (KEITOSAN, TANTOSHA)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚ PROBLEMA:                                                                     â”‚
â”‚   - Definidos en UserRole enum                                                â”‚
â”‚   - NO en require_role() hierarchy                                            â”‚
â”‚   - Hardcodeados en yukyu.py solo                                             â”‚
â”‚   - En role_permissions.py para configuraciÃ³n dinÃ¡mica                        â”‚
â”‚                                                                               â”‚
â”‚ INCONSISTENCIA:                                                               â”‚
â”‚   require_role("admin") â†’ NO incluye KEITOSAN, TANTOSHA                      â”‚
â”‚   Direct check en yukyu.py â†’ Incluye KEITOSAN                                â”‚
â”‚   role_permissions.py â†’ Incluye KEITOSAN, TANTOSHA                           â”‚
â”‚                                                                               â”‚
â”‚ DECISIÃ“N REQUERIDA:                                                           â”‚
â”‚   1. DEPRECAR: Migrar usuarios a nuevos roles                                â”‚
â”‚   2. INTEGRAR: Agregar a jerarquÃ­a (entre COORDINATOR y KANRININSHA)         â”‚
â”‚   3. DOCUMENTAR: Claramente como legacy, mantener pero no expandir           â”‚
â”‚                                                                               â”‚
â”‚ RECOMENDACIÃ“N: OpciÃ³n 1 (DEPRECAR) o OpciÃ³n 2 (INTEGRAR)                    â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PatrÃ³n 4: DOBLE ALMACENAMIENTO DE TOKENS                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚ FLUJO ACTUAL:                                                                 â”‚
â”‚   Backend: Retorna token en JSON body + HttpOnly cookies                     â”‚
â”‚   Frontend: Guarda en localStorage + cookies                                 â”‚
â”‚   Axios: Lee de localStorage, agrega header "Authorization: Bearer"          â”‚
â”‚                                                                               â”‚
â”‚ PROBLEMA:                                                                     â”‚
â”‚   - localStorage = vulnerable a XSS                                           â”‚
â”‚   - Si XSS compromete localStorage, token robado                             â”‚
â”‚   - Cookies HttpOnly ya estÃ¡n seguros                                         â”‚
â”‚   - Redundancia innecesaria                                                   â”‚
â”‚                                                                               â”‚
â”‚ SOLUCIÃ“N:                                                                     â”‚
â”‚   1. NO guardar en localStorage                                               â”‚
â”‚   2. Axios lee de cookies automÃ¡ticamente                                     â”‚
â”‚   3. Backend mantiene HttpOnly cookies como source of truth                  â”‚
â”‚   4. Refresh tambiÃ©n vÃ­a cookies                                              â”‚
â”‚                                                                               â”‚
â”‚ IMPLEMENTACIÃ“N:                                                               â”‚
â”‚   - Remover localStorage de auth-store.ts                                     â”‚
â”‚   - Remover getAuthToken() de api.ts                                          â”‚
â”‚   - Axios con withCredentials: true para cookies                              â”‚
â”‚   - Backend envÃ­a solo en cookies (no en body)                                â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     PLAN DE UNIFICACIÃ“N (RECOMENDADO)                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. AUTH_SERVICE (Centralizado)
   â”œâ”€ require_role("super_admin")
   â”œâ”€ require_role("admin")        â† Todos los demÃ¡s deben usar esto
   â”œâ”€ require_role("coordinator")
   â”œâ”€ require_role("kanrininsha")
   â”œâ”€ require_role("employee")
   â””â”€ require_role("contract_worker")

2. LEGACY ROLES (DecisiÃ³n requerida)
   â”œâ”€ OPCIÃ“N A: Deprecar KEITOSAN, TANTOSHA
   â”œâ”€ OPCIÃ“N B: Integrar en jerarquÃ­a
   â””â”€ OPCIÃ“N C: Mantener en role_permissions solo

3. ENDPOINTS (Refactorizar)
   â”œâ”€ apartments_v2.py: Usar require_role("coordinator")
   â”œâ”€ employees.py: Usar require_role("super_admin")
   â”œâ”€ salary.py: Usar require_role("admin")
   â”œâ”€ timer_cards.py: Centralizar en require_role()
   â””â”€ yukyu.py: Usar require_role() + legacy handling

4. FRONTEND (Refactorizar)
   â”œâ”€ auth-store.ts: Remover localStorage
   â”œâ”€ api.ts: Confiar en cookies HttpOnly
   â””â”€ Axios: withCredentials: true

5. MODELOS (Documentar)
   â”œâ”€ UserRole enum: Claramente quÃ© es legacy
   â””â”€ DocumentaciÃ³n: CuÃ¡ndo usar cada rol

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


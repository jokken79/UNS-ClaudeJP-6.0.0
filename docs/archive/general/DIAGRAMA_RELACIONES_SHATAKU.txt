DIAGRAMA DE RELACIONES - SISTEMA DE 社宅 (Shataku/Apartamentos)
==================================================================

TABLAS Y RELACIONES:

┌─────────────────┐
│     users       │
│ (ID, username)  │
└────────┬────────┘
         │
         │ created_by, updated_by
         ▼
┌─────────────────────────────────────────┐
│              apartments                 │
│  (id, apartment_code, address, rent,    │
│   capacity, building_type, etc.)        │
└─────────────────┬───────────────────────┘
                  │
                  │ apartment_id
                  ▼
┌──────────────────────────────────────────────┐
│         apartment_assignments                │
│  (id, employee_id, apartment_id,             │
│   status, start_date, end_date,              │
│   monthly_rent, payment_method, etc.)        │
└────────────────────┬─────────────────────────┘
                     │
                     │ assignment_id
                     ▼
┌──────────────────────────────────────┐
│          rent_deductions             │
│ (id, assignment_id, charge_id,       │
│  amount, deduction_type, etc.)       │
└────────────┬─────────────────────────┘
             │
             │ charge_id
             ▼
┌──────────────────────────────────────┐
│         additional_charges           │
│ (id, charge_name, charge_type,       │
│  calculation_type, etc.)             │
└──────────────────────────────────────┘

┌─────────────────┐
│    employees    │
│ (id, hakenmoto, │
│  full_name,     │
│  etc.)          │
└────────┬────────┘
         │
         │ id (employee_id)
         ▼
┌──────────────────────────────────────────────┐
│         apartment_assignments                │
│  (id, employee_id, apartment_id, ...)        │
└──────────────────────────────────────────────┘

CARDINALIDADES:

- users 1:N apartments
- apartments 1:N apartment_assignments
- apartment_assignments 1:N rent_deductions
- additional_charges 1:N rent_deductions
- employees 1:N apartment_assignments

FLUJO DE DATOS:

1. Un apartamento puede tener múltiples asignaciones a lo largo del tiempo
2. Cada asignación puede tener múltiples cargos adicionales
3. Los cargos adicionales son configurables y reutilizables
4. El historial completo se mantiene para auditoría

CASOS DE USO PRINCIPALES:

1. Asignar empleado a apartamento
   → Crear registro en apartment_assignments
   → Crear registros en rent_deductions para cada cargo

2. Calcular costo total
   → JOIN apartment_assignments con rent_deductions
   → SUM(monthly_rent + additional_charges)

3. Ver historial de empleado
   → WHERE employee_id = ?
   → ORDER BY start_date DESC

4. Buscar apartamentos disponibles
   → WHERE is_available = true
   → AND capacity > COUNT(asignaciones ACTIVAS)

5. Gestionar cargos
   → additional_charges es catálogo maestro
   → rent_deductions es instancia por asignación
